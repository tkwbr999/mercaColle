# mercaColle（メルカコレ）

Mercariのスマート払い利用明細を取得するChrome拡張機能

## 🚀 機能

- **利用明細取得**: Mercariスマート払いページから取引明細（件名・日付・金額）を抽出
- **ページ構造検査**: デバッグ用のページ構造分析機能
- **CSVエクスポート**: 取得した明細をCSVファイルでダウンロード
- **データ管理**: ローカルストレージでの明細データ保存・削除

## 📋 対応ページ

- `https://jp.mercari.com/mypage/merpay/smartpayment/easypay/select`

## 🔧 インストール

1. このリポジトリをクローン
2. Chrome の拡張機能ページ（`chrome://extensions/`）を開く
3. 「デベロッパーモード」を有効にする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `mercaColle-extension` フォルダを選択

## 📖 使用方法

1. **Mercariスマート払い明細ページにアクセス**

   - `https://jp.mercari.com/mypage/merpay/smartpayment/easypay/select`

2. **拡張機能を実行**

   - ブラウザの拡張機能アイコンをクリック
   - 「利用明細取得」ボタンを押す

3. **取得できない場合**

   - 「ページ構造検査」ボタンでデバッグ
   - F12でコンソールを開いて詳細ログを確認

4. **データのエクスポート**
   - 「CSVエクスポート」ボタンでファイルダウンロード

### ⚠️ 重要：サイト構造への依存について

この拡張機能は **Mercariのサイト構造（DOM要素のセレクタやクラス名）に依存** しています。

- **Mercariがサイトの構造を変更した場合、拡張機能が正常に動作しなくなる可能性があります**
- ページの HTML 構造やCSS クラス名が変更されると、明細の抽出ができなくなります
- このような場合は、拡張機能のアップデートが必要になります

**対処方法：**

- 拡張機能が動作しなくなった場合は、Issue を報告してください
- 「ページ構造検査」機能でページの変更を確認できます
- 定期的にMercariのサイト更新に合わせてメンテナンスが必要です

## 🛠️ 開発

### 依存関係のインストール

```bash
cd mercaColle-extension
npm install
```

### コード品質チェック

```bash
# ESLint（コード品質チェック）
npm run lint

# Prettier（コードフォーマット）
npm run format

# ESLintで自動修正
npm run lint:fix

# フォーマットチェック
npm run format:check
```

### テスト実行

```bash
# 全テスト実行
npm test

# ユニットテストのみ
npm run test:unit

# E2Eテストのみ
npm run test:e2e

# カバレッジ付きでテスト実行
npm run test:coverage

# ウォッチモードでテスト実行
npm run test:watch
```

### プロジェクト構成

```
mercaColle/
├── README.md               # このファイル
└── mercaColle-extension/   # Chrome拡張機能
    ├── manifest.json       # 拡張機能設定
    ├── popup/              # ポップアップUI
    │   ├── popup.html
    │   ├── popup.css
    │   └── popup.js
    ├── src/                # コンテンツスクリプト
    │   └── content.js
    ├── tests/              # テストファイル
    │   ├── unit/           # ユニットテスト
    │   ├── e2e/            # E2Eテスト
    │   └── setup.js        # テストセットアップ
    └── package.json        # パッケージ設定
```

## 🔍 取得できるデータ

- **件名**: 取引の名称（例：テスト商品サービス、サンプル決済項目）
- **日付**: 取引日時（例：2025/06/08 07:43）
- **金額**: 取引金額（例：¥3,850）

### 📊 CSVエクスポート形式

freeeでのインポートに対応した形式で出力されます：

- **ヘッダ行なし**
- **日付形式**: yyyy-MM-dd（時間部分は削除）
- **金額形式**: 数値のみ（¥マークとカンマを削除）

**出力例**:

```
"テスト商品サービス","2025-06-08","3850"
"サンプル決済項目","2025-06-06","1554"
```

## 🐛 トラブルシューティング

### 明細が取得できない場合

1. **ページが完全に読み込まれているか確認**

   - ページのスクロールダウンで全ての明細を表示

2. **デバッグ機能を使用**

   - 「ページ構造検査」ボタンをクリック
   - F12でConsoleタブを開いて詳細ログを確認

3. **対応ページかどうか確認**
   - URLが `https://jp.mercari.com/mypage/merpay/smartpayment/easypay/select` であることを確認

### よくある問題

- **拡張機能が動作しない**: ページを再読み込みしてから再試行
- **データが表示されない**: しばらく待ってから「利用明細取得」を再実行
- **一部のデータが欠落**: Mercariページの構造変更の可能性（Issue報告をお願いします）

## 📝 技術仕様

- **Manifest Version**: 3
- **対応ブラウザ**: Chrome（Chromium系ブラウザ）
- **権限**: `activeTab`, `storage`
- **対象ドメイン**: `jp.mercari.com`

## 📄 ライセンス

MIT License

## 🤝 貢献

Issue や Pull Request を歓迎します！

## ⚠️ 注意事項

- この拡張機能は個人利用目的で作成されています
- Mercariの利用規約に従ってご使用ください
- 取得したデータの取り扱いには十分注意してください
