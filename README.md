# mercaColle（メルカコレ）

Mercariのスマート払い利用明細を簡単に取得・CSV出力できるChrome拡張機能

## 🎯 この拡張機能でできること

**Mercariスマート払いの利用明細を自動で取得して、freeeなどの会計ソフトで使えるCSVファイルに変換できます**

### 主な機能
- ✅ **ワンクリックで明細取得**: ボタン一つで取引データを自動抽出
- ✅ **CSVエクスポート**: freee対応形式でダウンロード
- ✅ **データ管理**: 取得したデータの保存・削除
- ✅ **デバッグ機能**: 問題発生時の原因特定

## 🔧 インストール方法

### 方法1: リリース版ZIPファイルを使用（推奨）

1. [GitHubのリリースページ](https://github.com/tkwbr999/mercaColle/releases)から最新版のZIPファイルをダウンロード
2. ZIPファイルを解凍
3. Chrome の拡張機能ページ（`chrome://extensions/`）を開く
4. 「デベロッパーモード」を有効にする
5. 「パッケージ化されていない拡張機能を読み込む」をクリック
6. 解凍したフォルダを選択

### 方法2: 開発版（リポジトリからクローン）

1. このリポジトリをクローン
2. Chrome の拡張機能ページ（`chrome://extensions/`）を開く
3. 「デベロッパーモード」を有効にする
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `extension` フォルダを選択

## 📖 使い方

### 1. Mercariスマート払いページにアクセス
```
https://jp.mercari.com/mypage/merpay/smartpayment/easypay/select
```

### 2. 拡張機能を実行
1. ブラウザの拡張機能アイコンをクリック
2. 「利用明細取得」ボタンを押す
3. 取得完了まで少し待つ

### 3. CSVファイルをダウンロード
- 「CSVエクスポート」ボタンでファイルをダウンロード
- freeeにそのままインポート可能

## 📊 取得されるデータ

| 項目 | 例 | 説明 |
|------|----|----|
| **件名** | テスト商品サービス | 取引の名称 |
| **日付** | 2025-06-08 | 取引日（freee形式） |
| **金額** | 3850 | 取引金額（数値のみ） |

### CSV出力例
```csv
"テスト商品サービス","2025-06-08","3850"
"サンプル決済項目","2025-06-06","1554"
```

## 🚨 よくある問題と解決方法

### 明細が取得できない場合

**1. ページが完全に読み込まれていない**
- ページを下までスクロールして全ての明細を表示
- ページを再読み込みしてから再試行

**2. 対応ページでない**
- URLが `https://jp.mercari.com/mypage/merpay/smartpayment/easypay/select` であることを確認

**3. データが表示されない**
- しばらく待ってから「利用明細取得」を再実行
- 「ページ構造検査」ボタンでデバッグ情報を確認

### デバッグ方法

問題が発生した場合：
1. 「ページ構造検査」ボタンをクリック
2. F12でConsoleタブを開く
3. 詳細ログを確認
4. 必要に応じてIssueを報告

## ⚠️ 重要な注意事項

### サイト構造への依存について
この拡張機能は **Mercariのサイト構造に依存** しています。

**Mercariがサイトを更新した場合：**
- 拡張機能が動作しなくなる可能性があります
- その場合は、拡張機能のアップデートが必要です

**対処方法：**
- 動作しなくなった場合は、GitHubのIssueで報告してください
- 「ページ構造検査」機能で変更を確認できます

### 利用規約について
- この拡張機能は個人利用目的で作成されています
- **Mercariの利用規約に従ってご使用ください**
- 取得したデータの取り扱いには十分注意してください

## 🛠️ 開発者向け情報

### 依存関係のインストール
```bash
cd extension
npm install
```

### コード品質チェック
```bash
# ESLint（コード品質チェック）
npm run lint

# Prettier（コードフォーマット）
npm run format

# ESLintで自動修正
npm run lint:fix

# フォーマットチェック
npm run format:check
```

### テスト実行
```bash
# 全テスト実行
npm test

# ユニットテストのみ
npm run test:unit

# E2Eテストのみ
npm run test:e2e

# カバレッジ付きでテスト実行
npm run test:coverage

# ウォッチモードでテスト実行
npm run test:watch
```

### プロジェクト構成

```
mercaColle/
├── README.md               # このファイル
└── extension/              # Chrome拡張機能
    ├── manifest.json       # 拡張機能設定
    ├── popup/              # ポップアップUI
    │   ├── popup.html
    │   ├── popup.css
    │   └── popup.js
    ├── src/                # コンテンツスクリプト
    │   └── content.js
    ├── tests/              # テストファイル
    │   ├── unit/           # ユニットテスト
    │   ├── e2e/            # E2Eテスト
    │   └── setup.js        # テストセットアップ
    └── package.json        # パッケージ設定
```

### 配布用ZIPファイル

リリース時に作成されるZIPファイルには以下が含まれます:

- `manifest.json` - 拡張機能の設定
- `popup/` - ポップアップUIファイル
- `src/` - コンテンツスクリプト
- `assets/` - アイコンファイル

**除外されるファイル**:
- `node_modules/` - 依存関係
- `tests/` - テストファイル
- `coverage/` - テストカバレッジ
- `.git/` - Git関連ファイル
- `*.log` - ログファイル
- `package-lock.json` - 依存関係ロックファイル
- `.DS_Store` - macOSシステムファイル
- `dist/`, `build/` - ビルド出力ディレクトリ
- `.env*` - 環境変数ファイル
- `*.tmp`, `*.temp` - 一時ファイル

## 📝 技術仕様

- **Manifest Version**: 3
- **対応ブラウザ**: Chrome（Chromium系ブラウザ）
- **権限**: `activeTab`, `storage`
- **対象ドメイン**: `jp.mercari.com`

## 📄 ライセンス

MIT License

## 🤝 貢献・連絡先

### バグ報告・機能要望
- GitHubのIssueで報告してください
- Pull Requestも歓迎します！

### 連絡先
- **X（Twitter）**: [@tkwbr999](https://twitter.com/tkwbr999)

### サポート
拡張機能が動作しない場合や、Mercariのサイト構造変更による問題が発生した場合は、上記の連絡先またはGitHubのIssueでお知らせください。
